<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Search Components for Sift</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #f3f4f6; padding-bottom: 100px; }
        .section-title { font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem; color: #374151; border-left: 4px solid #3b82f6; padding-left: 0.75rem; }
    </style>
</head>
<body class="p-8 space-y-12">

    <!-- ==========================================
         COMPONENT 1: The Expandable Dropdown Search
         Use case: Top Navigation Bar
         ========================================== -->
    <section class="max-w-3xl mx-auto">
        <h2 class="section-title">1. The Header Dropdown (Contextual)</h2>
        
        <div class="relative group z-50">
            <!-- Main Input -->
            <div class="flex shadow-sm rounded-lg overflow-hidden border border-gray-300 bg-white">
                <div class="px-4 py-3 bg-gray-50 border-r border-gray-200 text-gray-500">
                    <i data-lucide="search" class="w-5 h-5"></i>
                </div>
                <input type="text" id="comp1-keyword" class="w-full px-4 py-3 outline-none" placeholder="Search users, orders, or items...">
                <button onclick="toggleComp1()" class="px-4 py-3 bg-white text-blue-600 font-medium hover:bg-gray-50 transition border-l">
                    Filters <i data-lucide="chevron-down" class="w-4 h-4 inline ml-1"></i>
                </button>
                <button onclick="searchComp1()" class="px-6 py-3 bg-blue-600 text-white font-medium hover:bg-blue-700 transition">
                    Search
                </button>
            </div>

            <!-- Advanced Panel (Hidden by default) -->
            <div id="comp1-panel" class="hidden absolute top-full left-0 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-xl p-6">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                        <select id="comp1-category" class="w-full border-gray-300 border rounded-md p-2 focus:ring-2 focus:ring-blue-500">
                            <option value="">All Categories</option>
                            <option value="electronics">Electronics</option>
                            <option value="clothing">Clothing</option>
                            <option value="books">Books</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select id="comp1-status" class="w-full border-gray-300 border rounded-md p-2 focus:ring-2 focus:ring-blue-500">
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="archived">Archived</option>
                        </select>
                    </div>
                    <div class="col-span-2">
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="comp1-exact" class="rounded text-blue-600 focus:ring-blue-500">
                            <span class="text-sm text-gray-600">Exact Match Only (Case Sensitive)</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==========================================
         COMPONENT 2: The Sidebar Faceted Search
         Use case: E-commerce or Library listing
         ========================================== -->
    <section class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="md:col-span-4">
            <h2 class="section-title">2. Sidebar Faceted Filters</h2>
        </div>

        <!-- Sidebar -->
        <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-200">
            <div class="space-y-6">
                
                <!-- Price Range ($gt, $lt) -->
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Price Range</h3>
                    <div class="flex items-center gap-2">
                        <input type="number" id="comp2-min" placeholder="Min" class="w-full border p-2 rounded text-sm">
                        <span class="text-gray-400">-</span>
                        <input type="number" id="comp2-max" placeholder="Max" class="w-full border p-2 rounded text-sm">
                    </div>
                </div>

                <!-- Tags ($in) -->
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Tags</h3>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" name="comp2-tags" value="premium" class="rounded text-blue-600">
                            <span class="text-sm text-gray-600">Premium</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" name="comp2-tags" value="sale" class="rounded text-blue-600">
                            <span class="text-sm text-gray-600">On Sale</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" name="comp2-tags" value="new" class="rounded text-blue-600">
                            <span class="text-sm text-gray-600">New Arrival</span>
                        </label>
                    </div>
                </div>

                <!-- Date ($gte) -->
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Created After</h3>
                    <input type="date" id="comp2-date" class="w-full border p-2 rounded text-sm text-gray-600">
                </div>

                <button onclick="searchComp2()" class="w-full py-2 bg-gray-900 text-white rounded hover:bg-gray-800">Apply Filters</button>
            </div>
        </div>

        <!-- Results Placeholder -->
        <div class="md:col-span-3 bg-white p-10 rounded-lg shadow-sm border border-gray-200 flex items-center justify-center text-gray-400">
            Results will appear here based on Sift filters...
        </div>
    </section>

    <!-- ==========================================
         COMPONENT 3: The Dynamic Query Builder
         Use case: Admin Dashboards / Data Mining
         ========================================== -->
    <section class="max-w-4xl mx-auto">
        <h2 class="section-title">3. Dynamic Query Builder (SQL/NoSQL Style)</h2>
        
        <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
            <div class="bg-gray-50 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="font-bold text-gray-700">Construct Query</h3>
                <button onclick="comp3AddRow()" class="text-sm flex items-center text-blue-600 hover:text-blue-800">
                    <i data-lucide="plus-circle" class="w-4 h-4 mr-1"></i> Add Condition
                </button>
            </div>
            
            <div id="comp3-rows" class="p-6 space-y-3">
                <!-- Initial Row -->
                <div class="query-row flex flex-col md:flex-row gap-3 items-center">
                    <select class="q-field w-full md:w-1/4 border-gray-300 border rounded p-2 text-sm">
                        <option value="username">Username</option>
                        <option value="age">Age</option>
                        <option value="role">Role</option>
                    </select>
                    <select class="q-operator w-full md:w-1/4 border-gray-300 border rounded p-2 text-sm">
                        <option value="$eq">Equals</option>
                        <option value="$ne">Not Equals</option>
                        <option value="$gt">Greater Than</option>
                        <option value="$regex">Contains (Regex)</option>
                    </select>
                    <input type="text" class="q-value w-full md:w-1/3 border-gray-300 border rounded p-2 text-sm" placeholder="Value...">
                    <button onclick="this.parentElement.remove()" class="text-red-500 hover:bg-red-50 p-2 rounded">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end">
                <button onclick="searchComp3()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded shadow-sm">
                    Run Query
                </button>
            </div>
        </div>
    </section>

    <!-- ==========================================
         COMPONENT 4: The Command Palette / Modal
         Use case: Keyboard-first power search (Ctrl+K)
         ========================================== -->
    <section class="max-w-3xl mx-auto text-center">
        <h2 class="section-title text-left">4. The Command Palette (Modal)</h2>
        <button onclick="document.getElementById('comp4-modal').classList.remove('hidden')" class="bg-gray-800 text-white px-8 py-3 rounded-full shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
            Open Search Modal (Cmd+K)
        </button>

        <!-- Modal Overlay -->
        <div id="comp4-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-start justify-center pt-20">
            <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl overflow-hidden animate-fade-in-down">
                <!-- Header -->
                <div class="border-b border-gray-200 p-4">
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-3 top-3 text-gray-400 w-5 h-5"></i>
                        <input id="comp4-input" type="text" class="w-full pl-10 pr-4 py-2 text-lg outline-none placeholder-gray-400" placeholder="Type to search...">
                        <button onclick="document.getElementById('comp4-modal').classList.add('hidden')" class="absolute right-0 top-2 text-gray-400 hover:text-gray-600 bg-gray-100 rounded px-2 text-xs py-1">ESC</button>
                    </div>
                </div>
                
                <!-- Advanced Tabs -->
                <div class="bg-gray-50 px-4 py-2 border-b border-gray-200 flex space-x-4 text-sm">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="comp4-files" class="mr-2"> Files
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="comp4-users" class="mr-2"> Users
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="comp4-archived" class="mr-2"> Include Archived
                    </label>
                </div>

                <!-- Footer Action -->
                <div class="p-3 bg-gray-100 text-right">
                    <button onclick="searchComp4()" class="text-blue-600 font-bold text-sm">Search &rarr;</button>
                </div>
            </div>
        </div>
    </section>

    <!-- ==========================================
         COMPONENT 5: Chip/Tag Based Input
         Use case: Email clients or Jira-style filtering
         ========================================== -->
    <section class="max-w-3xl mx-auto">
        <h2 class="section-title">5. Natural Language / Chip Search</h2>
        
        <div class="w-full bg-white border border-gray-300 rounded-lg p-2 flex flex-wrap gap-2 focus-within:ring-2 focus-within:ring-blue-500 shadow-sm" id="comp5-container">
            <!-- Chips will be injected here -->
            <div class="bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full flex items-center space-x-1">
                <span>role:admin</span>
                <button onclick="this.parentElement.remove()" class="hover:text-blue-900"><i data-lucide="x" class="w-3 h-3"></i></button>
            </div>

            <input type="text" id="comp5-input" class="flex-grow min-w-[150px] outline-none text-gray-700 px-2 py-1" placeholder="Type filter (e.g. status:active) and hit Enter...">
        </div>
        <div class="mt-2 text-xs text-gray-500">
            Try typing: <b>price:>100</b>, <b>category:books</b>, or just keywords.
        </div>
        <button onclick="searchComp5()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded shadow-sm">Generate Sift Query</button>
    </section>

    <!-- ==========================================
         JAVASCRIPT LOGIC
         ========================================== -->
    <script>
        // Initialize Icons
        lucide.createIcons();

        // --- Component 1 Logic ---
        function toggleComp1() {
            const panel = document.getElementById('comp1-panel');
            panel.classList.toggle('hidden');
        }

        function searchComp1() {
            const keyword = document.getElementById('comp1-keyword').value;
            const category = document.getElementById('comp1-category').value;
            const status = document.getElementById('comp1-status').value;
            const isExact = document.getElementById('comp1-exact').checked;

            // Constructing a Sift-friendly Query
            let query = {};
            
            if (keyword) {
                // If exact match is checked, use simple equality, otherwise Regex
                query.name = isExact ? keyword : { $regex: keyword, $options: 'i' };
            }
            if (category) query.category = category;
            if (status) query.status = status;

            console.log("Component 1 Query:", query);
            alert("Check Console for Sift Query Object");
        }


        // --- Component 2 Logic ---
        function searchComp2() {
            const min = document.getElementById('comp2-min').value;
            const max = document.getElementById('comp2-max').value;
            const date = document.getElementById('comp2-date').value;
            
            // Get checked tags
            const checkedTags = Array.from(document.querySelectorAll('input[name="comp2-tags"]:checked'))
                                     .map(cb => cb.value);

            let query = {};

            // Handle Price Range
            if (min || max) {
                query.price = {};
                if (min) query.price.$gte = Number(min);
                if (max) query.price.$lte = Number(max);
            }

            // Handle Tags ($in operator)
            if (checkedTags.length > 0) {
                query.tags = { $in: checkedTags };
            }

            // Handle Date
            if (date) {
                query.createdAt = { $gte: new Date(date).toISOString() };
            }

            console.log("Component 2 Query:", query);
            alert("Check Console for Sift Query Object");
        }


        // --- Component 3 Logic ---
        function comp3AddRow() {
            const container = document.getElementById('comp3-rows');
            const newRow = document.createElement('div');
            newRow.className = "query-row flex flex-col md:flex-row gap-3 items-center";
            newRow.innerHTML = `
                <select class="q-field w-full md:w-1/4 border-gray-300 border rounded p-2 text-sm">
                    <option value="username">Username</option>
                    <option value="age">Age</option>
                    <option value="role">Role</option>
                </select>
                <select class="q-operator w-full md:w-1/4 border-gray-300 border rounded p-2 text-sm">
                    <option value="$eq">Equals</option>
                    <option value="$ne">Not Equals</option>
                    <option value="$gt">Greater Than</option>
                    <option value="$regex">Contains (Regex)</option>
                </select>
                <input type="text" class="q-value w-full md:w-1/3 border-gray-300 border rounded p-2 text-sm" placeholder="Value...">
                <button onclick="this.parentElement.remove()" class="text-red-500 hover:bg-red-50 p-2 rounded">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            `;
            container.appendChild(newRow);
            lucide.createIcons(); // Refresh icons
        }

        function searchComp3() {
            const rows = document.querySelectorAll('.query-row');
            let query = {};

            rows.forEach(row => {
                const field = row.querySelector('.q-field').value;
                const operator = row.querySelector('.q-operator').value;
                let value = row.querySelector('.q-value').value;

                // Simple type coercion for age
                if(field === 'age') value = Number(value);

                if (value) {
                    if (operator === '$eq') {
                        query[field] = value;
                    } else {
                        // Ensure we don't overwrite existing operators on the same field
                        if(!query[field]) query[field] = {};
                        query[field][operator] = value;
                    }
                }
            });

            console.log("Component 3 Query:", query);
            alert("Check Console for Sift Query Object");
        }


        // --- Component 4 Logic ---
        function searchComp4() {
            const text = document.getElementById('comp4-input').value;
            const searchFiles = document.getElementById('comp4-files').checked;
            const searchUsers = document.getElementById('comp4-users').checked;
            const includeArchived = document.getElementById('comp4-archived').checked;

            let query = {
                $or: [] // Sift OR operator
            };

            // Build pattern matching for keyword
            const keywordFilter = { $regex: text, $options: 'i' };

            if (searchFiles) {
                query.$or.push({ type: 'file', name: keywordFilter });
            }
            if (searchUsers) {
                query.$or.push({ type: 'user', username: keywordFilter });
            }
            
            // If nothing selected, search generic description
            if (query.$or.length === 0) {
                query.description = keywordFilter;
            }

            if (!includeArchived) {
                query.archived = { $ne: true };
            }

            console.log("Component 4 Query:", query);
            document.getElementById('comp4-modal').classList.add('hidden');
            alert("Check Console for Sift Query Object");
        }


        // --- Component 5 Logic ---
        const comp5Input = document.getElementById('comp5-input');
        const comp5Container = document.getElementById('comp5-container');

        comp5Input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && this.value.trim() !== "") {
                createChip(this.value.trim());
                this.value = "";
            }
        });

        function createChip(text) {
            const chip = document.createElement('div');
            chip.className = "bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full flex items-center space-x-1 chip-data";
            chip.dataset.value = text;
            chip.innerHTML = `
                <span>${text}</span>
                <button onclick="this.parentElement.remove()" class="hover:text-blue-900 font-bold ml-1">Ã—</button>
            `;
            comp5Container.insertBefore(chip, comp5Input);
        }

        function searchComp5() {
            const chips = document.querySelectorAll('.chip-data');
            let query = {};

            chips.forEach(chip => {
                const raw = chip.dataset.value; 
                if (raw.includes(':')) {
                    const [key, val] = raw.split(':');
                    
                    if (val.startsWith('>')) {
                        query[key] = { $gt: Number(val.substring(1)) };
                    } else if (val.startsWith('<')) {
                        query[key] = { $lt: Number(val.substring(1)) };
                    } else {
                        query[key] = val;
                    }
                } else {
                    // Generic keyword search
                    if (!query.$or) query.$or = [];
                    query.$or.push({ description: { $regex: raw, $options: 'i' }});
                }
            });

            console.log("Component 5 Query:", query);
            alert("Check Console for Sift Query Object");
        }
    </script>
</body>
</html>